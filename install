#  -*- mode: ruby; -*-

#!/usr/bin/env ruby

#
# Install script for dotfiles
#

require 'rake'

DOTFILES_ROOT = File.join(File.expand_path(ENV['HOME']), '.dotfiles')

case RUBY_PLATFORM
when /darwin/
  # macOS pre-reqs
  unless File.exist?('/usr/bin/xcode-select')
    puts "Xcode required. Install from macOS app store."
    sh "open https://itunes.apple.com/us/app/xcode/id497799835?mt=12"
    exit(false)
  end

  unless Dir.exist?('/Library/Developer/CommandLineTools')
    sh "/usr/bin/xcode-select --install"
  end
when /linux/
  # Linux pre-reqs
when /windows/
  # Windows pre-reqs
end

# Check if dotfiles installed
unless Dir.exist?(DOTFILES_ROOT)
  sh "git clone https://github.com/ascarter/dotfiles #{DOTFILES_ROOT}"
end

# Run initial bootstrap
cd DOTFILES_ROOT
app = Rake::Application.new()
app.init
app.load_rakefile

task = Rake::Task['default']
task.invoke
