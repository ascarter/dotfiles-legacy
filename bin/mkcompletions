#!/bin/zsh

# Generate tab completions
# This updates generated completions that cannot be directly loaded in zshrc

emulate -L zsh

COMPLETIONS_DIR=${ZDOTDIR:-$HOME/.zsh}/completions
mkdir -p ${COMPLETIONS_DIR}

# Swift
if type swift &>/dev/null; then
	echo "Generating swift completions..."
	swift package completion-tool generate-zsh-script > ${COMPLETIONS_DIR}/_swift
fi

# Rust
if type rustup &>/dev/null; then
	echo "Generating rustup completions..."
	rustup completions zsh > ${COMPLETIONS_DIR}/_${rustup}
fi

# Docker
if [[ -d /Applications/Docker.app ]]; then
	for f in docker docker-compose docker-machine; do
		echo "Generating ${f} completions..."
		ln -fs /Applications/Docker.app/Contents/Resources/etc/${f}.zsh-completion ${COMPLETIONS_DIR}/_${f}
	done
fi

# Kubernetes
if type kubectl &>/dev/null; then
	echo "Generating kubectl completions..."
	kubectl completion zsh > ${COMPLETIONS_DIR}/_kubectl
fi

# if [[ -f /Applications/YubiKey\ Manager.app/Contents/MacOS/ykman ]]; then
# 	echo "Generating ykman completions..."
# 	_YKMAN_COMPLETE=source /Applications/YubiKey\ Manager.app/Contents/MacOS/ykman > ${COMPLETIONS_DIR}/_ykman
# fi


echo "Reload shell to load completions."
